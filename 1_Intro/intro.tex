\chapter{Introduction}
\label{chapter:introduction}
\thispagestyle{myheadings}

\section{A Brief History Of Kleene Algebra}
\label{sec:history}


\paragraph{Our Contributions}

\section{Technical Background}

\subsection{Kleene Algebra and Homomorphisms}

A \emph{Kleene Algebra} (KA) is an idempotent semiring with an iteration operator \((-)^*\).
For a KA \(𝒦\) and elements \(p, q, r ∈ 𝒦\) the complete list of axiom is listed below:
\begin{align*}
  p + 0 = 0 + p & = p & \text{ identity} \\
  p + q &= q + p & \text{commutativity}\\
  (p + q) + r & = p + (q + r) & \text{associativity} \\
  p + p & = p & \text{idempotency} \\
  1 p = p 1 & = p & \text{identity} \\
  (p  q)  r & = p  (q  r) & \text{associativity}\\
  (p + q) r & = pr + qr & \text{right distributivity} \\
  r (p + q) & = rp + rq & \text{left distributivity} \\
  0 p = p 0 & = 0 & \text{annihilation} \\
  1 + p^* p = 1 + p p^* & = p^* 
  & \text{unfolding} \\
  q + pr ≤ r & ⟹ p^* q ≤ r & 
  \text{induction} \\
  q + rp ≤ r & ⟹ qp^* ≤ r & 
  \text{induction};
\end{align*} 
the ordering \(≤\) in KA inherits the conventional ordering in idempotent semiring
\[ p ≤ q ⟺ p + q = q.\]
Notice that in every idempotent semiring, 
the sum of a finite set of elements \(P\) compute the supremum of that set:
\[q ≥ ∑ P ⟺ ∀ p ∈ P, q ≥ p \text{ and } ∀ p ∈ P, ∑ P ≥ p.\]
Furthermore, the star operation in KA also satisfy several nice properties, for example:
\[(p^*)^* = e^*, \qquad p^* ⋅ p^* = p^*, \qquad (p + q)^* = p^*(q p^*)^*.\]

Like every other algebraic structures, mapping between KA is an important subject of study.
As we will show later, a lot of the known concepts in KA 
can be defined using properties of maps between KA.
A \emph{KA homomorphism} between two KA \(𝒦\) and \(𝒦'\) is a map \(h: 𝒦 → 𝒦'\)
that preserves all the KA operations, namely, for all \(p, q ∈ 𝒦\) the following equations hold:
\begin{align*}
  h(p + q) &= h(p) + h(q) \\  
  h(p ⋅ q) &= h(p) ⋅ h(q) \\  
  h(p^*) &= h(p)^*.
\end{align*}


\subsection{Free KA And Interpretations}

In order to reason about logical properties like completeness about KA,
it is important to define expressions and interpretations in Kleene algebra.
A \emph{KA alphabet} \(K\) is a finite set; we call the elements \(p ∈ K\) \emph{primitives}.
Given an alphabet \(K\), 
we can construct all the Kleene Algebra terms over \(K\) with the following grammar:
\[e = p ∈ K ∣ 1 ∣ 0 ∣ e₁ + e₂ ∣ e₁ ⋅ e₂ ∣ e^*.\]
And these terms forms the free KA:
\begin{definition}[Free KA]
  The free KA \(\KA(K)\) over an alphabet \(K\) is a KA 
  s.t. for all KA \(𝒦\) and a set map \(Î: K → 𝒦\),
  there exists a unique KA homomorphism \(I: \KA(K) → 𝒦\), where the following diagram commutes:
  \[
  \begin{tikzcd}
    \KA(K) \ar[dashed]{r}{I} & 𝒦 \\  
    K \ar[swap]{ur}{Î} \ar[hookrightarrow]{u}{i}
  \end{tikzcd}
  \]
  where \(i: K → \KA(K)\) is the inclusion map.
  Since there exists a bijection between set maps \(Î: K → 𝒦\) 
  and homomorphisms \(I: K → 𝒦\),
  we will use \(I\) to denote both \(Î\) and \(I\) for simplicity.
  We will also sometimes omit \(K\) and just write \(\KA\)
  if \(K\) is irrelevant or can be inferred from context.
  We sometimes say \(I\) is \emph{lifted} from the action on the primitives \(Î\).
\end{definition}

The free KA over \(K\) can be constructed as all the KA terms over \(K\)
modulo provable equalities in KA. 
The operations in free KA is purely syntactic, 
for example, the addition of two terms \(e₁, e₂ ∈ \KA(K)\) will 
simply yield the term \(e₁ + e₂\).
Furthermore, the homomorphism \(I: \KA(K) → 𝒦\) is inductively generated 
from \(Î: K → 𝒦\) as follows:
\begin{align*}
  I & : \KA(K) → 𝒦 \\
  I & (p) ≜ Î(p) & p ∈ K \\
  I & (e₁ + e₂) ≜ I(e₁) + I(e₂) \\  
  I & (e₁ ⋅ e₂) ≜ I(e₁) ⋅ I(e₂) \\  
  I & (t^*) ≜ I(t)^*
\end{align*}
The uniqueness of \(I\) can be derived by unfolding the definition of homomorphisms.
Homomorphisms from free KA is called \emph{KA interpretations}.
By definition of the free KA, 
a KA interpretation is uniquely determined by the action on the primitives, i.e.
for two interpretations \(I, I': \KA(K) → 𝒦\):
\[∀ p ∈ K, I(p) = I'(p) ⟺ ∀ e ∈ \KA(K), I(e) = I'(e).\]

\subsection{Complete KA Interpretations}\label{sec: complete KA interpretation}

One important property for interpretation is completeness.
We say an interpretation \(I\) is \emph{complete} when the following equivalence holds:
\[∀e₁, e₂ ∈ \KA(K), e₁ = e₂ ⟺ I(e₁) = I(e₂).\]
If we consider \(I\) as a desirable semantics for \(\KA(K)\),
then this means that all the semantical equalities can be derived using just the theory,
a very desirable quality of a proof system.

It is quite easy to see from the definition, 
a interpretation is complete if and only if it is injective.
This realization enables us to compose injective homomorphisms 
to obtain complete interpretations.

One of such complete interpretation, as we have mentioned before, is the language interpretation.
Kozen has showed that the powerset of any monoid generates a Kleene Algebra~\cite{Kozen_2002},
and the language KA over alphabet \(K\) is generated by the free monoid over \(K\).
We denote the free monoid over \(K\) as \(\Word(K)\), 
and we call the elements \emph{words over \(K\)};
finally, we denote the identity of the monoid \(ϵ\), called the \emph{empty word}.
More explicitly, the language KA \(ℒ_{K}\) over \(K\) can be defined as follows:
\begin{itemize}[nosep]
  \item The carrier set is all the languages (sets of words) over the alphabet \(K\).
  \item The additive identity \(0\) is the empty set. 
  \item The multiplicative identity \(1\) is the singleton set with the empty string \(\{ϵ\}\).
  \item The addition operation is set union.
  \item The multiplication operation is element-wise concatenation:
    \[l₁ ⋅ l₂ ≜ \{w₁ w₂ ∣ w₁ ∈ l₁, w₂ ∈ l₂\}.\]
  \item The star operation is the closure under finite concatenation:
    \[l^* ≜ ⋃_{i ∈ ℕ} l^{i} \text{ where } l^0 ≜ ϵ, l^{(j + 1)} ≜ l^{j} ⋅ l.\]
\end{itemize}
The language interpretation of KA is defined by lifting the following action on primitives \(p\):
\[L(p) ≜ \{p\}.\]
The completeness result of the language interpretation is a seminal result in Kleene algebra,
proven independently by Kozen and Korb~\cite{Kozen_1994,Krob_1991}, 
and the proof was later improved several times~\cite{Kozen_2001,Silva_2010,Kozen_Silva_2020}.


Another important class of Kleene Algebra is relational Kleene Algebra,
where it is typically used to model input and output relation of a program.
A relational Kleene Algebra \(ℛ\) over a set \(X\) is defined as follows:
\begin{itemize}
  \item The carrier is a set of relations \(ℛ ⊆ 𝒫(X × X)\) that is closed under the following operations 
  \item The additive identity \(0\) is the empty relation \(∅\).
  \item The multiplicative identity \(1\) is the identity relation \(\{(x, x) ∣ x ∈ X\}\).
  \item The addition operation is set union.
  \item The multiplication is sequential composition:
    \[r₁ ; r₂ ≜ \{(a, c) ∣ ∃ b ∈ X, (a, b) ∈ r₁, (b, c) ∈ r₂\}.\]
  \item The star operation is the reflexive transitive closure:
    \[r^* ≜ ⋃_{i ∈ ℕ} r^{i} \text{ where } r^0 ≜ 1, r^{(j + 1)} ≜ r^{j} ; r.\]
\end{itemize}
We denote all the relational model over all sets \(\REL\).
We say that a equality \(e₁ = e₂\) is valid in all relational model, 
when for all relational KA \(ℛ\) and relational interpretation \(I: \KA → ℛ\), \(I(e₁) = I(e₂)\). 
We use \(\REL ⊧ e₁ = e₂\) to denote that \(e₁ = e₂\) is valid in all relational models.
And in fact relational model is complete, i.e.
\[e₁ = e₂ ⟺ \REL ⊧ e₁ = e₂.\]
This result is obtained by the classical Pratt's trick~\cite{Pratt_1980},
which constructs a homomorphic embedding \(h: ℒ_{K} → \Word(K) × \Word(K)\)
from the language model to a specific relational model.
By the injectivity of \(h\), \(h ∘ L: \KA(K) → \Word(K) × \Word(K)\) is also injective, 
hence a complete interpretation.
Therefore, \[\REL ⊧ e₁ = e₂ ⟹ h ∘ L(e₁) = h ∘ L(e₂) ⟹ e₁ = e₂.\]
And the reverse implication is straightforward, because for all interpretation \(I\), 
\[e₁ = e₂ ⟹ I(e₁) = I(e₂).\]


\subsection{Constructing Kleene Algebras}

Besides the three important class of Kleene Algebras in~\Cref{sec: complete KA interpretation},
we also can construct Kleene Algebra from known Kleene Algebras.
By leveraging these constructions, 
we can produce well-structured Kleene Algebra with ease.

Upper-triangular matrix model enjoys nice properties that will be crucial in later development.
Given a KA \(𝒦\), the square upper-triangular matrices over \(𝒦\) of size \(n\), 
denoted as \(M_{n}(𝒦)\), forms a Kleene Algebra, 
with matrix addition, matrix multiplication, 
and a star operation inductively defined as follows~\cite{Kozen_1994}:
\[
  \begin{bmatrix}
    A & B \\
    0 & D
  \end{bmatrix}^* ≜
  \begin{bmatrix}
    A^* & A^* B D^* \\  
    0 & D^*
  \end{bmatrix},
\]
where \(A, D\) are square block matrices, and \(B\) is a block matrix.

\begin{corollary}\label{the: diagonal projection is homomorphism}
  Projections of the diagonal element of upper-triangular matrices 
  are homomorphisms:
  \[π_{n, n}: M_{m}(𝒦) → 𝒦 \text{ where } n ≤ m.\]
\end{corollary}

\begin{proof}
  By induction on the size of the matrix.
  TODO
\end{proof}

\begin{corollary}\label{the: diagonal image of free model is closed under sub KA}
  Given an interpretation into a matrix model \(I: \KA(X) → M_m(𝒦)\)
  and a Kleene subalgebra \(𝒦' ⊆ 𝒦\), 
  any diagonal projection \(π_{n, n}\) satisfy the following equivalences:
  \[∀ a ∈ X, π_{n, n}(I(a)) ⊆ 𝒦' ⟺ ∀ e ∈ \KA(X), π_{n, n}(I(e)) ⊆ 𝒦'.\]
\end{corollary}

\begin{proof}
  Direct consequence of \Cref*{the: diagonal projection is homomorphism}.
\end{proof}

Another important class of models are models bounded by a single element:
\begin{theorem}
  Given a KA \(𝒦\), and an element \(p ∈ 𝒦\), 
  if \(p ≥ 1\) and \(p ⋅ p ≤ p\), then all the element in \(𝒦\) that is smaller than \(p\)
  forms a Kleene Algebra.
\end{theorem}

\begin{proof}
  We need to show that \(\{q ∣ q ≤ p\}\) is closed under all operation of KA.
  We will show the star case as an example.
  Given an element \(q ≤ p\), we need to show \(q^* ≤ p\).
  By induction rule \[q p ≤ p p ≤ p ⟹ q^* p ≤ p ⟹ q^* ≤ q^* p ≤ p.\qedhere\]
\end{proof}
We denote the Kleene algebra formed by all the elements in \(𝒦\) 
that is less than \(p\) as \(𝒦ₚ\).



\subsection{Kleene Algebra With Tests}

A classical extension of KA is Kleene Algebra with Tests (KAT)~\cite{Kozen_Smith_1997}, 
which is a two-sorted algebra \((ℬ, 𝒦)\), s.t. 
\(ℬ\) is a boolean algebra where the elements are called \emph{tests}; 
\(𝒦\) is a Kleene algebra where the elements in \(𝒦 ∖ ℬ\) are called \emph{actions}; 
and \(ℬ\) is a subalgebra of \(𝒦\) where the disjunction and conjunction operator in \(ℬ\)
respectively coincide with the addition and multiplication in \(𝒦\).

A \emph{KAT alphabet} consists of two disjoint finite set \(K, B\);  
the elements in \(K\) are called \emph{primitive actions} 
and the elements in \(B\) are called \emph{primitive tests}.
Given a KAT alphabet \(K, B\), we can define KAT terms as follows:
\[t = p ∈ K ∣ b ∈ B ∣ \overline{t_b} ∣ 1 ∣ 0 ∣ t₁ + t₂ ∣ t₁ ⋅ t₂ ∣ t^*,\]
where \(t_b\) do not contain any primitive actions.
Notice boolean terms like \(t₁ ∨ t₂\) are not presented here, 
this is because the disjunction operator coincide with addition, 
hence by definition \(t₁ ∨ t₂\) is the same as \(t₁ + t₂\).

Indeed most of the results and definitions from Kleene Algebra 
carry over to Kleene Algebra with tests.
A \emph{KAT homomorphism} \(h\) is a map that preserves the sort and all the operations.
Concretely it is a KA homomorphism on \(𝒦\), 
and a boolean homomorphism when restricted to \(ℬ\).
A \emph{free KAT over \(K, B\)} is a KAT that satisfy the same universality as free KA:
for all KAT \(𝒦\) and a set map \(K + B → 𝒦\),
there exists a unique homomorphism, s.t. the following diagram commutes,
\[
  \begin{tikzcd}
    \KAT(K,B) \ar[dashed]{r}{I} & 𝒦 \\  
    K+B \ar[swap]{ur}{Î} \ar[hookrightarrow]{u}{i}
  \end{tikzcd}
\]
and \(i\) is the inclusion function.
The free KAT over \(K, B\) can be explicitly constructed as 
the set of KAT terms over \(K, B\) modulo the provable equalities of KAT.
Finally KAT is complete over guarded string interpretation \(G\) 
and relational models~\cite{Kozen_Smith_1997}.

It is not a coincidence that all of the constructions in KAT and KA are similar;
in fact, concepts like terms, homomorphisms, 
and free models are standard concepts in universal algebra~\cite{Burris_Sankappanavar_1981}.
Because our work have limited use of universal algebra 
and we do not make much contributions in that subject, 
we will not have a detailed introduction to universal algebra
nor will we seek to generalize our results to the generality of universal algebra.

The importance of KAT arises from modeling program behavior by using 
actions to represent basic components, tests to represent guards, 
multiplication to represent sequential composition, 
addition to represent random choice, and star to represent iteration. 
Concretely, KATs can be used to model while programs using the following encoding~\cite{Kozen_1997}:
\begin{align*}
    \comITE{b}{p}{q} & ≜ b p + b̄ q; \\
    \comWhile{b}{p} & ≜ (b p)^* b̄.
\end{align*}
Furthermore, a Hoare triple \(\{b\}~p~\{c\}\) can be encoded using the following two 
equivalent encodings~\cite{Kozen_2000, Manes_Arbib_1986}:
\[b p = b p c, \qquad b p c̄ = 0.\]
